# API Governance

## Версионирование
- Используем `SemVer` для публичного API (`vMAJOR.MINOR.PATCH`).
- Базовый путь REST: `/api/v1/*`. Повышение MAJOR требует выпуск `/api/v2` с параллельной поддержкой не менее 6 месяцев.
- MINOR-версии допускают добавление полей/эндпоинтов без ломки обратной совместимости.
- PATCH — исправления без изменения контрактов.

## Изменения и депрекации
- Любое устаревание помечается заголовком `Sunset` и полем `deprecated: true` в OpenAPI.
- Минимальный срок deprecation — 90 дней.
- Обновления документируются в `docs/changelog.md` (создать при реализации).

## Политика breaking changes
- Запрещено удалять поля или менять их тип в рамках MINOR/PATCH.
- Изменение семантики (например, переход из `int` в `string`) требует MAJOR-версии.
- В ответах запрещено изменять порядок обязательных шагов (например, auth flow) без миграционного плана.
- Обязательные параметры не могут становиться опциональными без документирования.

## Управление схемой
- Исходная спецификация хранится в `openapi.yaml` в корне.
- Автотесты проверяют совпадение схемы с реализацией (`openapi-diff`, `spectral lint`).
- PR с изменениями в API должны включать:
  - Обновление OpenAPI.
  - Обновлённые примеры в `docs/*.md`.
  - Обновление SDK при необходимости.

## Генерация SDK
- TypeScript клиент: `npx openapi-typescript openapi.yaml -o web/src/lib/api.ts`.
- Kotlin/Swift: OpenAPI Generator (`openapi-generator-cli generate`).
- Версии SDK синхронизированы с MINOR-версиями API (например, `sdk-ts@1.4.0` ↔ `API v1.4`).

## Контрактные тесты
- Для каждого публичного эндпоинта есть контрактные тесты (Go + Dredd/Postman/Newman).
- В CI выполняется сравнение живого сервера с OpenAPI (`prism mock` + e2e сценарии).

## Политика релизов
- Каждому релизу присваивается тэг `api/vX.Y.Z`.
- Публикуется release note с описанием изменений и миграционных шагов.
- Новые версии API проходят бета-тест на sandbox окружении минимум 2 недели.

